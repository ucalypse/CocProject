@using System.Web.UI.WebControls
@model ClashOfClans.Models.WarViewModel
@{
    ViewBag.Title = "War Room";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>War Room</h2>
<body>
    <div class="jumbotron">
        @if (Model.CurrentWar.State == "inWar")
        {
            <h2 id="warMessage">Time Until War Ends</h2>
        }
        else
        {
            <h2>Time Until War Begins</h2>
        }

        <div id="renderTime"></div>
    </div>
<div id="popupContact" class="modal">
    <div class="modal-content">
        <span class="close" id="closeButton">&times;</span>
       <div class="form-group">
                <input type="text" id="memberName" name="memberName" class="form-control" placeholder="Member Name"/>
                <textarea id="warPlan" style="height: 300px;" class="form-control" name="warPlan" placeholder="Enter War Plan"></textarea>
                <button class="btn-primary" id="submitButton">Submit</button>
            </div>
        
    </div>
</div>
<div id="displayWarPlan" class="col-md-6">
    <h3>The War Plan...</h3>
    <button class="btn-group-sm" id="button">Add War Plan (Admin Only)</button>
   
</div>
</body>
<script>
    $(function() {
        $.getJSON('/Home/ConvertedDateTime')
            .done(function(response) {
                var countDownDate = new Date(response).getTime();
                var x = setInterval(function() {

                        var now = new Date().getTime();

                        var distance = countDownDate - now;

                        var seconds = Math.floor((distance / 1000) % 60);
                        var minutes = Math.floor((distance / 1000 / 60) % 60);
                        var hours = Math.floor((distance / (1000 * 60 * 60)));

                        $("#renderTime").html(
                            (hours + 8) + "h " + minutes + "m " + seconds + "s ");

                        if (distance < 0) {
                            clearInterval(x);
                            $("#renderTime").html("War Over");
                        }
                },
                1000);
            });
        $("#button").click(function() {
            $("#popupContact").css("display", "block");
        });

        $("#closeButton").click(function () {
            $("#popupContact").css("display", "none");
        });

        $("#submitButton").click(function () {
            var war = $("#warPlan").val();
            $.post( "/Home/SendWarPlan", { memberName : $("#memberName").value, warPlan : war })
                .done(function (data) {
                    $("#displayWarPlan").html("<p>" + war + "</p>");
                    $("#popupContact").css("display: none");
                });
        });
    });
   
   
</script>

